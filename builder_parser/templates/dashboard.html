{% load static %}
<!DOCTYPE html>
<html>
<head>
  <title>–î–∞—à–±–æ—Ä–¥ –∫–≤–æ—Ç</title>
  <link rel="stylesheet" href="{% static 'css/base.css' %}">
  <style>
    li.flex-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }
    .btn-delete {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      color: red;
    }
    .pagination {
      margin-top: 1.5rem;
      display: flex;
      justify-content: center;
      gap: 1rem;
      align-items: center;
    }
  </style>
</head>
<body>
  <div class="container">

    <h2>–°–ø–∏—Å–æ–∫ –ö–ü</h2>

    <form method="get" style="margin-bottom: 1rem;">
      <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞..." value="{{ request.GET.q }}">
      <button type="submit">–ù–∞–π—Ç–∏</button>
    </form>

    <p>
      <button type="button" onclick="createQuote()" class="btn">‚ûï –ù–æ–≤–æ–µ –ö–ü</button>
    </p>

    {% if quotes %}
      <ul>
        {% for quote in quotes %}
          <li class="flex-item">
            <a href="{% url 'quote_detail' quote_id=quote.id %}">
              {{ quote.client_name }} ‚Äî {{ quote.created_at|date:"Y-m-d H:i" }} ‚Äî {{ quote.materials|join:", " }}
            </a>
            <form method="post" action="{% url 'quote_delete' quote.id %}" style="margin: 0;">
              {% csrf_token %}
              <button type="submit" class="btn-delete" title="–£–¥–∞–ª–∏—Ç—å"
                onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –ö–ü –¥–ª—è {{ quote.client_name }}?')">üóë</button>
            </form>
          </li>
        {% endfor %}
      </ul>

      {% if quotes.has_other_pages %}
        <div class="pagination">
          {% if quotes.has_previous %}
            <a href="?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}page={{ quotes.previous_page_number }}">‚Üê –ù–∞–∑–∞–¥</a>
          {% endif %}

          <span>–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ quotes.number }} –∏–∑ {{ quotes.paginator.num_pages }}</span>

          {% if quotes.has_next %}
            <a href="?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}page={{ quotes.next_page_number }}">–í–ø–µ—Ä—ë–¥ ‚Üí</a>
          {% endif %}
        </div>
      {% endif %}

    {% else %}
      <p>–ù–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Ä–∞—Å—á—ë—Ç–æ–≤</p>
    {% endif %}

    <p style="margin-top: 2rem;"><a href="{% url 'logout' %}">–í—ã–π—Ç–∏</a></p>
  </div>

<script>
  function createQuote() {
    const clientName = prompt("–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ö–ü:");
    if (!clientName || clientName.trim() === "") return;
    const encodedName = encodeURIComponent(clientName.trim());
    window.location.href = "{% url 'quote_create' %}?client=" + encodedName;
  }
</script>

</body>
</html>

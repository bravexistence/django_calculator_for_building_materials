{% load static %}
<!DOCTYPE html>
<html>
<head>
  <title>–ö–ü {{ quote.client_name }}</title>
  <link rel="stylesheet" href="{% static 'css/base.css' %}">
</head>
<body>
<div class="container">
  <h2>–ö–ü –¥–ª—è {{ quote.client_name }}</h2>
  <p><strong>–î–∞—Ç–∞:</strong> {{ quote.created_at|date:"Y‚Äëm‚Äëd¬†H:i" }}</p>

  <form method="post" novalidate>
    {% csrf_token %}

    {{ form.non_field_errors }}

    <fieldset>
      <legend>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</legend>
      {{ form.materials }}
    </fieldset>

    <!-- —Ä–∞–∑–º–µ—Ä—ã –ø–æ–¥–∫–ª–∞–¥–æ–∫ -->
    <div id="pvh-fields" {% if "–ø–≤—Ö" not in quote.materials %}style="display:none"{% endif %}>
      {{ form.width_pvh.label_tag }} {{ form.width_pvh }}¬†–º <br>
      {{ form.height_pvh.label_tag }} {{ form.height_pvh }}¬†–º
    </div>

    <div id="alyuk-fields" {% if "–∞–ª—é–∫" not in quote.materials %}style="display:none"{% endif %}>
      {{ form.width_alyuk.label_tag }} {{ form.width_alyuk }}¬†–º <br>
      {{ form.height_alyuk.label_tag }} {{ form.height_alyuk }}¬†–º
    </div>

    <h3>–ë–ª–æ–∫–∏</h3>

    {{ formset.management_form }}

    <table id="blocks-table">
      <thead>
        <tr><th>–†–∞–∑–º–µ—Ä</th><th>–ö–æ–ª‚Äë–≤–æ</th><th>–£–¥–∞–ª–∏—Ç—å</th></tr>
      </thead>
      <tbody>
        {% for f in formset %}
          <tr>
            {{ f.id }}
            <td>
              {{ f.letter_size.errors }}{{ f.letter_size }}
            </td>
            <td>
              {{ f.letter_count.errors }}{{ f.letter_count }}
            </td>
            <td>
              {% if f.instance.pk %}{{ f.DELETE }}{% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- –®–∞–±–ª–æ–Ω –ø—É—Å—Ç–æ–π —Ñ–æ—Ä–º—ã –¥–ª—è JS -->
    <template id="empty-form-template">
      <tr>
        {{ formset.empty_form.id }}
        <td>__letter_size__</td>
        <td>__letter_count__</td>
        <td></td>
      </tr>
    </template>
    <button type="submit">üíæ¬†–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </form>

  <hr>

  <h3>–ò—Ç–æ–≥</h3>
<p><strong>–ö–ª–∏–µ–Ω—Ç:</strong> {{ quote.client_name }}</p>
<p><strong>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</strong> {{ quote.created_at|date:"Y-m-d H:i" }}</p>

<p><strong>–í—Å–µ–≥–æ –±—É–∫–≤:</strong> {{ quote.total_letters }}</p>
<p><strong>–ö–æ–ª-–≤–æ –¥–∏–æ–¥–æ–≤:</strong> {{ quote.total_diodes }}</p>
<p><strong>–ö–æ–ª-–≤–æ –∫–ª–µ—è:</strong> {{ quote.total_glue }}</p>
<p><strong>–ê–∫—Ä–∏–ª –º¬≤:</strong> {{ quote.total_acrylic }}</p>
<p><strong>–ü–í–• –º¬≤:</strong> {{ quote.total_pvc }}</p>
<p><strong>–ö–æ–ª-–≤–æ –ø–æ–ª–æ—Å:</strong> {{ quote.total_stripes }}</p>
<p><strong>–û—Ä–∞–∫–∞–ª –º¬≤:</strong> {{ quote.total_oracal_m2 }}</p>
<p><strong>–ü—Ä–æ–≤–æ–¥–∞ –º.–ø.:</strong> {{ quote.total_wire_m }}</p>
<p><strong>–ú–æ—â–Ω–æ—Å—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ç–æ—Ä–∞ (–í—Ç):</strong> {{ quote.total_power_watt }}</p>
<p><strong>–õ–∏—Å—Ç–æ–≤:</strong> {{ quote.sheets }}</p>
<p><strong>–ü—Ä–æ—Ñ–∏–ª—å –®–¢:</strong> {{ quote.profile }}</p>
<p><strong>–°–∏–ª–∏–∫–æ–Ω:</strong> {{ quote.silicone }}</p>
<p><strong>–û—Ä–∞–∫–∞–ª:</strong> {{ quote.oracal }}</p>
<p><strong>–ó–∞–¥–Ω–∏–∫–∏:</strong> {{ quote.total_back }}</p>
<p><strong>–õ–∏—Å—Ç–æ–≤ –Ω–∞ –ª–∏—Ü–µ–≤—ã–µ:</strong> {{ quote.face_sheets }}</p>
<p><strong>–õ–∏—Å—Ç–æ–≤ –Ω–∞ –ø–æ–ª–æ—Å—ã:</strong> {{ quote.stripe_sheets }}</p>
<p><strong>–ü/–º –æ—Ä–∞–∫–∞–ª 1 –º–µ—Ç—Ä —à–∏—Ä–∏–Ω–∞:</strong> {{ quote.oracal_pm_1m }}</p>
<p><strong>–ü/–º –æ—Ä–∞–∫–∞–ª 1.2 –º–µ—Ç—Ä–∞ —à–∏—Ä–∏–Ω–∞:</strong> {{ quote.oracal_pm_1_2m }}</p>

{% if "–ø–≤—Ö" in quote.materials %}
  <p><strong>–®–∏—Ä–∏–Ω–∞ –ü–í–• (–º):</strong> {{ quote.width_pvh }}</p>
  <p><strong>–í—ã—Å–æ—Ç–∞ –ü–í–• (–º):</strong> {{ quote.height_pvh }}</p>
  <p><strong>–ü–ª–æ—â–∞–¥—å –ü–í–•:</strong> {{ quote.area_pvh }}</p>
{% endif %}

{% if "–∞–ª—é–∫" in quote.materials %}
  <p><strong>–®–∏—Ä–∏–Ω–∞ –ê–ª—é–∫–æ–±–æ–Ω–¥–∞ (–º):</strong> {{ quote.width_alyuk }}</p>
  <p><strong>–í—ã—Å–æ—Ç–∞ –ê–ª—é–∫–æ–±–æ–Ω–¥–∞ (–º):</strong> {{ quote.height_alyuk }}</p>
  <p><strong>–ü–ª–æ—â–∞–¥—å –ê–ª—é–∫–æ–±–æ–Ω–¥–∞:</strong> {{ quote.area_alyuk }}</p>
{% endif %}

<p><strong>–ü–ª–æ—â–∞–¥—å –≤—ã–≤–µ—Å–∫–∏:</strong> {{ quote.area }} –º¬≤</p>

  <p style="margin-top:2rem;"><a href="{% url 'dashboard' %}">‚Üê¬†–ù–∞–∑–∞–¥</a></p>
</div>

<script>
  // –ø–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –ø–æ–ª–µ–π –ø–æ–¥–∫–ª–∞–¥–∫–∏
  const materialsInputs = document.querySelectorAll('input[name="materials"]');
  const pvhBlock  = document.getElementById('pvh-fields');
  const alyukBlock = document.getElementById('alyuk-fields');

  materialsInputs.forEach(i => i.addEventListener('change', () => {
    pvhBlock.style.display  = document.querySelector('input[value="–ø–≤—Ö"]').checked  ? '' : 'none';
    alyukBlock.style.display = document.querySelector('input[value="–∞–ª—é–∫"]').checked ? '' : 'none';
  }));

  // –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ –±–ª–æ–∫–∞
  const addBtn      = document.getElementById('add-block');
  const tableBody   = document.querySelector('#blocks-table tbody');
  const tmpl        = document.getElementById('empty-form-template').content;
  const totalInput  = document.getElementById('id_{{ formset.prefix }}-TOTAL_FORMS');

  addBtn.addEventListener('click', () => {
    const formIdx = parseInt(totalInput.value, 10);
    const clone   = document.importNode(tmpl, true);

    // –∑–∞–º–µ–Ω—è–µ–º __prefix__ –Ω–∞ –∏–Ω–¥–µ–∫—Å —Ñ–æ—Ä–º—ã
    clone.innerHTML = clone.innerHTML
      .replace(/__prefix__/g, formIdx)
      .replace('__letter_size__', '<select name="{{ formset.prefix }}-' + formIdx + '-letter_size">' +
                                   '{{ formset.empty_form.letter_size.field.choices|safe }}' + '</select>')
      .replace('__letter_count__', '<input type="number" name="{{ formset.prefix }}-' + formIdx + '-letter_count" min="1">');

    tableBody.appendChild(clone);
    totalInput.value = formIdx + 1;
  });
</script>
</body>
</html>
